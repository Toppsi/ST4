\textit{I dette kapitel diskuteres projektets metode og opnåede resultater. Derudover konkluderes der på baggrund af problemformuleringen og kravene til det samlede systemet hvorledes prototypen opfylder tiltænkte formål. Afslutningsvis perspektiveres prototypen i forhold til samfundsmæssige problemstillinger samt systemforbedringer.}

\section{Diskussion}\label{sec:diskussion}
\textit{Afsnittet diskuterer og vurderer projektets indhold for derefter at kunne opstille eventuelle forbedringsmuligheder med henblik på en systemoptimering.}

Problemanalysen undersøger kvaliteten af en række aktivitetsmålere med udgangspunkt i udvalgte succeskriterier. Det fremgår heraf, at ingen aktivitetsmålere opfylder alle opstillede kriterier. Det er derfor fordelagtigt at designe og udvikle en prototype, som har potentiale til at opfylde de opstillede krav. \\
Kravene er, at prototypen skal:
\begin{itemize}
	\item Kunne detektere aktiviteterne gang, løb og cykling ved brug af et gyroskop og et accelerometer. Der accepteres ikke brug af andre sensorer.
	\item Automatisk kunne adskille gang, løb og cykling ved hjælp af algoritmer. Der accepteres en afvigelse på 10\% i forhold til fejlvurdering af aktivitet.
	\item Kunne detektere varighed fra systemets start. Der accepteres en afvigelse på 10\% i forhold til fejlvurdering af den samlede varighed.	
	\item Kunne detektere puls ved brug af pulssensor og tilhørende algoritme samt derefter kategorisere intensiteten af en given aktivitet. Der accepteres en afvigelse på 10\%.
	\item Videresende signaler til en ekstern enhed ved hjælp af BLE. Der accepteres ikke andre trådløse kommunikationsformer.
	\item Besidde batterilevetid for en hel dag svarende til 15 timer. Der accepteres ikke en batterilevetid på mindre end 15 timer.
	\item Repræsentere varigheden og pointfordelingen af en given aktivitet i GUI. Der accepteres ikke en anden form for visualisering.	
\end{itemize}

\subsubsection{Resultater opnået i pilotforsøget}
Pilotforsøgets opnåede resultater diskuteres med henblik på at opnå normaliserede og dermed valide resultater til brug ved udvikling af en prototype.\\
Pilotforsøget har til formål at undersøge signalernes udformning, frekvensområde og amplitude ved gang, løb og cykling. Ydermere bliver signalerne undersøgt i forhold til placeringen af sensoren på benet. 

Pilotforsøget undersøger blandt andet signalers udformning ved gang, løb og cykling. Det ses, at der er stor forskel på signalernes amplituder for hver forsøgsperson ved gang og løb. Dette kan skyldes, at forsøgspersonerne ikke benyttede samme type fodtøj. Derfor vil personer, der har sko med en større stødabsorbering, opnå lavere amplituder ved gang og løb end personer i fodtøj med lavere stødabsorbering~\citep{Novacheck1998}. Det kan derfor antages, at en forsøgspopulation med sammenligneligt fodtøj vil medføre en mere identisk datarepræsentation. Det vil dermed være fordelagtigt at undersøge betydningen af fodtøjet. Ydermere vil en større forsøgspopulation give et mere repræsentativt datasæt, således validiteten af dataopsamlingen øges. En større forsøgspopulation vil ligeledes bidrage til dannelsen af en normale, hvoraf eventuelle algoritmer med større sandsynlighed vil fungere i praksis.\\
Pilotforsøgets forsøgspersoner har en højere vægt end det gennemsnitlige for rapportens målgruppe. I 2014 befandt børn i alderen 9-12~år sig gennemsnitligt i vægtklassen 28-42~kg~\citep{Rigsholspitalet2014}. Det er derfor antageligt, at g-påvirkningerne for forsøgspersonerne under pilotforsøget er højere, end hvis målgruppen udfører pilotforsøget. Derfor vil det være essentielt at udføre et pilotforsøg med en forsøgspopulation i aldersgruppen tilsvarende målgruppen. Datasættet og databehandlingen bliver dermed mere repræsentativt for rapportens målgruppe.\\
Pilotforsøget undersøger ikke gyroskopets output ved forsøgspersonernes maksimale kadence ved cykling. Kravene til prototypens gyroskop er dermed opstillet på baggrund af en tilnærmelsesvis konstant kadence. Det er bestemt, at prototypens gyroskop blot skal overholde et minimum kadence. Det vil derfor være fordelagtigt at undersøge forsøgspopulationens maksimale kadence ved cykling. Denne værdi kan benyttes til at opstille krav til arbejdsområdet for prototypens gyroskop samt at sikre, hvorledes gyroskopets data afspejles som et resultat af højere kadence.\\
Pilotforsøget undersøger signaludformningen for cykling ved en konstant kadence. Dette forsøg tager derfor ikke højde for en acceleration eller varierende kadence. Det vil derfor være fordelagtigt at undersøge betydningen af acceleration under cykling for signalets frekvensdomæne. Dette kan undersøges ved hjælp af en FFT. Idet dette ikke er undersøgt, vides det ikke, hvorledes accelererende cykling bliver detekteret af systemet.

\subsubsection{Udformning af systemets blokke}
Prototypens separate blokke er designet, implementeret og testet enkeltvis for at opretholde variabelkontrol under processen. Det samlede system er dog ikke et færdigudviklet produkt, som tager højde for alle relevante system- og brugermæssige aspekter for den enkelte blok. Det er eksempelvis ikke muligt med projektets tilgængelige midler at udforme en brugervenlig og komfortabel enhed, der er let at påføre brugeren.

Prototypens spændingsforbrug er testet ved benyttelse af systemet i 2,5~time. Det fremgår af testen, at GAP peripheral vil være funktionel i 8,3~timer ved en spændingstilkobling på 3,19~V fra ubrugte AAA batterier. Yderligere er denne antagelse men hensyn til et lineært spændingsforbrug for prototypen. Denne varighed overholder ikke det funktionelle krav for det samlede system, som fremsætter et krav på en batterilevetid på 15~timer. Det vil derfor være relevant at undersøge, om spændingsforbruget har en lineær sammenhæng over længere tid, hvoraf systemets egentlige levetid kan fastsættes. 

Prototypen involverer en pulsdetektering, som har til formål at kategorisere intensiteten af den pågældende aktivitet. Testen af prototypen viser sig at have en afvigelse på 0\% ved pulsdetektering på et simuleret signal. Ydermere bliver pulsdetekteringen testet på forsøgsperson, hvor vedkommende ikke udfører fysisk aktivitet. Det fremgår heraf, at pulsdetekteringen har en afvigelse på 8,15\% fra den benyttede reference. Dette kan blandt andet være som følge af en dårlig kontakt mellem pulssensor og øreflip. Hvis dette er tilfældet, vil signalets amplitude ikke være tilstrækkeligt stort til at overskride tærskelværdien. Dette blev observeret ved testens udførsel, hvor kontakten mellem sensor og hud blev bedre i takt som funktion af tiden. Som følge af en bedre kontakt blev signalets amplitude markant forøget. \\
Yderligere bliver pulsdetektering testet ved gang og løb på et løbebånd for at undersøge funktionaliteten heraf ved fysisk aktivitet. Testen påviser en afvigelse på -17,85\% og -46,4\% for henholdsvis gang og løb i forhold til den benyttede reference. Det blev observeret ved testens udførsel, at signalets udformning under gang og løb indeholdte støj, hvoraf denne støj var markant større ved løb. Det var derfor ikke muligt at foretage en pulsdetektering på dette signal. Testen blev ikke udført ved cykling, idet denne aktivitet ikke indebærer betydelig bevægelse af overkroppen. Dermed antages det, at pulssensoren formentlig ikke belastes betydeligt mere i forhold til en stillesiddende position. \\
Som følge af de observerede signaler samt påviste afvigelser vil det være fordelagtigt at udforme en anordning, som mindsker mængden af støj på signal. Dette kan eksempelvis opnås ved en anordning, der sænker risikoen for bevægelse af sensorens ledninger ved selve sensoren. Yderligere vil det være fordelagtigt at udforme en opsætning, som sikrer en stabil og konstant kontakt mellem sensor og hud. 

Den benyttede IC i prototypen indeholder et accelerometer og et gyroskop. Accelerometret testes og resultatet heraf er en afvigelse på maksimalt 1,4\%. Dette output fra accelerometeret har en lav afvigelse, hvormed accelerometerets output kan accepteres. Ydermere er det ikke været muligt at bestemme det maksimale arbejdsområde for accelerometeret på en videnskabelig måde. Dette skyldes, at der ikke er tilgængeligt udstyr, som kan påvirke accelerometeret med op til $\pm$16~g. Det er derfor antaget, at accelerometerets arbejdsområde er tilsvarende de konfigurerede indstillinger, som fabrikanten foreskriver i databladet. Det har ikke været muligt at bestemme gyroskopets nøjagtighed eller arbejdsområde grundet mangel på udstyr til kontrol af en konstant kadence. Det er derfor ligeledes antaget, at gyroskopets nøjagtighed og arbejdsområde er tilsvarende de konfigurerede indstillinger, som fabrikanten foreskriver i databladet. På baggrund af disse antagelser er det derfor ikke muligt at vurdere, hvorvidt outputdata fra gyroskopet er valid ved implementering i det endelig system. 

Prototypens rækkevidde for den trådløse kommunikation testes, hvor det fremgår, at ved en afstand på 4~meter mellem to MCUer mistes forbindelsen. Denne afstand testes, hvor begge PRoCs på MCUerne var placeret således, at de pegede mod hinanden og var tilkoblet spænding ved brug af USB porten. Det vil derfor være fordelagtigt yderligere at teste, hvilken betydning det har, når afstanden mellem enhederne er afskærmet af genstande eller personer. Dette kan eksempelvis testes ved, at en person har påmonteret MCUen på benet under et par bukser for dermed at simulere en påmontering af prototypen. Rækkevidden for den trådløse kommunikation antages derfor at blive mindsket ved disse forhold. \\
Derudover bør der testes, hvorledes en ekstern spændingsforsyning har betydning for rækkevidden den trådløse kommunikation. Dette er især essentielt, da GAP peripheral i det samlede system er tilkoblet en ekstern strømforsyning i form af to 1,5~V batterier.

\subsubsection{Resultater opnået ved test af det samlede system}
De enkelte blokke er testet og størstedelen af kravene hertil opfyldes. De funktionelle blokke er dermed samlet til en prototype, som er testet i forhold til de opstillede krav, der fremgår i \secref{krav_samlet_sys}.

Prototypen testes blandt andet for at undersøge, hvorvidt den udførte aktivitet detekteres og repræsenteres korrekt. Testen påviser, at der er en maksimal forskel på 5,1\% i forhold til detekteringen af den pågældende aktivitet. Prototypen er dermed i stand til at detektere og adskille gang, løb og cykling med en maksimal afvigelse på 5,1\%. \\
Det fremgår ydermere af testen, at de fysiske aktiviteter detekteres til en varighed på cirka 40~sekunder, på trods af at aktiviteten udføres i 60~sekunder. Dette svarer dermed til, at cirka hvert tredje sekund af den udførte aktivitet ikke detekteres. Kravet vedrørende detektering af varighed fra systemets start opfyldes ikke, idet den maksimale afvigelse er 40\%. Dette kan være som følge af en række softwaremæssige aspekter. Eksempelvis er algoritmen på MCUerne udført med henblik på at funktionalitet. Der er derfor ikke taget højde for varigheden af en eksekvering af algoritmen. Ved at forkorte varigheden for eksekvering af algoritmen vil dette antageligt have en forbedret effekt på algoritmens detektering. Dermed vil der være en større varighed detekteret af den udførte aktivitet. \\
Ydermere kan det antages, at MATLAB scriptet i sammenspil med mistede datapakker under BLE overførslen kan være en årsag til, at hver tredje sekund ikke detekteres. Hvis BLE overførslen forstyrres eller ikke modtages korrekt antages det, at IDet for datapakkerne ikke fremgår af første plads i arrayet. Derved registrerer MATLAB scriptet ikke data som værende fysisk aktivitet, hvorfor det ikke vil fremgå i GUI. 

Prototypen testes med hensyn til detektering af cykling. Det fremgår, at der er en afvigelse på 0\% mellem den totale mængde detekterede aktivitet og den udførte aktivitet. Denne test er dog udført for en konstant kadence. Det vil yderligere være fordelagtigt at teste betydningen af acceleration under cykling. Ved acceleration antages det dog, at frekvensområdet er mere spredt over en række frekvenser. Denne antagelse vil påkræve en test for at kunne optimere algoritmen, hvis acceleration af en kadence ikke detekteres som værende cykling. \\
Prototypen tester ikke, hvilken betydning en langsommere eller hurtigere kadence har for detekteringen af cykling. Det fremgår af pilotforsøget, at signalets udformning for cykling er tilsvarende en sinusbølge. Derfor er det antageligt, at en langsommere eller hurtigere kadence blot vil flytte magnituderne i frekvensdomænet til henholdsvis en lavere eller højere frekvens. Denne antagelse skal derfor testes for at undersøge, hvorvidt ovenstående har indvirkning på detekteringen af cykling.

Prototypen testes ved en hastighed på 8~km/t ved udførsel af aktiviteterne gang og løb. Der forekommer her en større procentvis afvigelse af den detekterede aktiviteten i forhold til den udførte aktivitet. Dette kan være som følge af den hastighed, som både gang og løb udføres med. Denne hastighed er valgt med udgangspunkt i et studie, som beskriver 6,4~km/t som rask gang og 9,7~km/t som løb~\citep{Miles2007}. 8~km/t antages derfor som værende en overgang mellem gang og løb. Det blev desuden observeret i pilotforsøget, at ved en hastighed mellem 8~km/t og 10~km/t skiftede forsøgspersonerne fra gang til løb. Under test af prototypen havde forsøgspersonerne besvær med at opretholde gang ved 8~km/t. Særligt var de kvindelige forsøgspersoner udfordret, idet disse forsøgspersoner ikke havde en naturlig gangcyklus ved denne hastighed. Derved detekteres gang som løb, når de kvindelige forsøgspersoner udførte gang ved 8~km/t. Prototypen detekterede ligeledes en større varighed af gang hos de mandlige forsøgspersoner. Denne forskel kan være som følge af højdeforskellen og dermed benlængden mellem de kvindelige og mandlige forsøgspersoner. Men da de kvindelige forsøgspersoner ikke havde en naturlig gangcyklus antages det, at denne cyklus ikke vil forekomme under normale omstændigheder i dagligt brug.