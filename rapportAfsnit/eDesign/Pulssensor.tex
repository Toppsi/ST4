\section{Pulsdetektering}\label{sec_de_im_te_puls}
\textit{I dette afsnit beskrives designet, implementeringen og testen af den valgte pulssensor.}

\subsection{Design} \label{sec_design_puls}
Pulssensoren skal benyttes til at beskrive intensiteten af aktiviteten, som beskrevet i \secref{subsub:ak_int}. Herudfra kan effekten af aktiviteten bestemmes, hvilket vil blive afspejlet som en motiverende faktor i forbindelse med visualisering ved brug af GUI. \newline
Pulssensoren SEN-11574 er valgt til dette projekt, da det er en optisk pulssensor og er derfor mere sikker for brugeren, som beskrevet i \secref{sec:pulssensor}. Ydermere er en optisk sensor alsidig i forhold til placering, idet denne type blot kræver en placering over en arterie for at kunne måle pulsen. \newline
Den valgte pulssensor, SEN-11574, kræver en spændingstilkobling på 3~V til 5~V for at være funktionel og forbruger 4~mA ved en forsyning på 5~V. På sensorens board findes et aktivt filter\fxnote{Et aktivt filter er en type af analog elektronisk filter, der anvender aktive bestanddele, såsom en forstærker.} samt en forstærker, som tilsammen øger amplituden for pulsbølgen og normaliserer signalet omkring et referencepunkt, hvilket fjerner DC spænding i signalet. \citep{Murphy2016,Murphy2016_sensor}

Pulssensoren designes således pulsen (BPM) beregnes for brugeren i GAP peripheral og sendes til GAP central, hvilket fremgår af \figref{fig:puls_pseudo}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{figures/cDesign/puls_pseudo.png}
	\caption{Illustration af pulssensorens funktioner på GAP peripheral. }
	\label{fig:puls_pseudo}
\end{figure}

Pulssensor opfanger pulssignalet fra brugeren, hvorefter dette signal sendes ind i PSoC 4200M på GAP peripheral. Der vil her forekomme en signalbehandling, som bestemmer gennemsnitspulsen for brugeren, hvilket ses på \figref{fig:puls_pseudo}. \\
Målgruppens højeste alder er 12 år, derfor vil målgruppens maksimale puls antageligt være <208 BPM, som det fremgår af \secref{krav_adc}. Systemet vil derfor kun godkende en puls der er <208 BPM, ellers vil den forrige gennemsnitspuls blive sendt.

FREKVENS - HENVISNING TIL KRAV
GENNEMSE KRAVSPECIFIKATIONER


\subsection{Implementering}
FORKLARING AF OPSÆTNINGEN AF DESIGN AF ALGORITME MED UDGANGSPUNKT I PSEUDO KODEN

Sensoren har 3 pins til henholdsvis spændingsforsyning, ground og outputsignal. Disse pins kobles til hver sin pin på GAP peripheral. Outputsignalets pin skal designes i programmet PSoC Creator, således MCU'en modtager pulssensorens signale fra den pågældende pin. Dette gøres ved at indsætte henholdsvis en UART serie kommunikationsblok (SCB) og SAR ADC i topdesignet. UART'en bruges for at sensoren og MCU'en kan kommunikere. Standardindstillingerne for denne blok benyttes til konfigurationen af MCUen. \newline
Outputsignalet fra sensoren er et analogt signal, hvormed dette signal skal gennem en ADC, for at skabe en konvertering til et digitalt signal. ADCens design skal derfor konfigurers således denne bearbejder én single ended kanal, inputtet fra pulssensoren. Yderligere indstilles sampleraten for ADcen for den pågældende kanal til 35~Hz, jævnfør \secref{krav_adc}. \\
Efter konfigurering af UART og ADC i Topdesignet, skal de korrekte pins indstilles i pinopsætning. UART tildeles interne pins, hvorimod ADC'ens inputpin skal indstilles til den plads, som outputtet fra sensoren er, hvilket i dette tilfælde er pin 2.0. 

%Igennem et MATLAB program er det muligt at visualisere pulsen ved hjælp af en GUI. I det samlede system skal denne GUI ikke være tilgængelig her i processen, da GAB peripheral modtager pulsdata og sender dette videre sammen med IC data til GAB central, som skal visualisere data i en endelig GUI.\\
%I matlabscriptet vælges den pågældende port for MCU'en i computeren, således PC'en kan registrere hvor det visualiserede data skal komme fra. Herefter startes scriptet og en figur tvinges i front med pulsen, hvor et bestemt antal sekunders vindue visualiseres

\subsection{Test}
Pulssensoren skal testes for, om den kan opfange brugerens puls under fysisk aktivitet uden ukorrekt eller ikke tydelig puls. Dette gøres ved, at der optages to målinger henholdsvis med og uden fysisk aktivitet, hvor sensoren placeres på den distale phalanges på højre hånds pegefinger. Ud fra matlab scriptet og tilhørende optagede data vurderes det, om pulsen visualiseres korrekt, således den korrekte puls kan kalkuleres.\\
Den fysiske aktivitet bestod af gang på et løbebånd. Hver måling optages i 10 sekunder, hvilket ses på \figref{fig:puls_m_u}.\\
%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.6]{figures/cDesign/ToPulser.png}
%	\caption{På figuren ses to plots for hver test af pulssensoren. På figur 1 til venstre står forsøgspersonen helt stille i 10 sekunder, hvorimod vedkommende går i en subjektiv vurdering af normal gang på figur 2 til højre. Der ses en tydelig puls på figur 1, hvorimod pulsen ikke fremgår på figur 2.}
%	\label{fig:puls_m_u}
%\end{figure}
Matlab scriptet udregnede

% Test af krav


% Grimme hjemmeside \citep{Murphy2016}
% \cite{Murphy2016_sensor}